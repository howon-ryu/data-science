library(arules)
library(ggplot2)
library(arulesViz)
library(shinythemes)
library(pmml)
library(caret)
library(rpart)
library(dplyr)
library(rattle)
social = read.csv("social.csv")
head(social)
summary(social)
social <- na.omit(social)
summary(social)
head(social)
dim(social)
social_transaction <- as(social, "transactions")
#social_transaction
summary(social_transaction)
#inspect(social_transaction)
#class(social_transaction)
# itemFrequencyPlot(social_transaction,
#                   topN=10,
#                   type="absolute",
#                   main="Item Frequency")
rules <- apriori (social_transaction,
parameter = list(supp = 0.1,
conf = 0.8))
#confidence 기준
rules_conf <- sort (rules, by="confidence", decreasing=TRUE)
inspect(head(rules_conf))
# lift기준
rules_lift <- sort (rules, by="lift", decreasing=TRUE)
inspect(head(rules_lift))
length(rules)
subsetRules <- which(rowSums(is.subset(rules, rules, proper = T)) > 1)
length(subsetRules)
#
rules <- rules[-subsetRules]
length(rules)
rules_r1 <- apriori (data=social_transaction,
parameter=list (supp=0.05,
conf = 0.3
),
appearance = list (default="rhs",
lhs="만족감=만족"))
#control = list (verbose=F))
rules_conf_r1 <- sort (rules_r1, by="confidence", decreasing=TRUE)
inspect(head(rules_conf_r1,5))
rules_conf_r1 <- sort (rules_r1, by="lift", decreasing=TRUE)
inspect(head(rules_conf_r1,5))
rules_r2 <- apriori (data=social_transaction,
parameter=list (supp=0.05,
conf = 0.3
),
appearance = list (default="rhs",
lhs="만족감=보통"))
#control = list (verbose=F))
rules_conf_r2 <- sort (rules_r2, by="confidence", decreasing=TRUE)
inspect(head(rules_conf_r2,5))
rules_conf_r2 <- sort (rules_r2, by="lift", decreasing=TRUE)
inspect(head(rules_conf_r2,5))
rules_r3 <- apriori (data=social_transaction,
parameter=list (supp=0.05,
conf = 0.3
),
appearance = list (default="rhs",
lhs="만족감=불만족"))
#control = list (verbose=F))
rules_conf_r3 <- sort (rules_r3, by="confidence", decreasing=TRUE)
inspect(head(rules_conf_r3,5))
rules_conf_r3 <- sort (rules_r3, by="lift", decreasing=TRUE)
inspect(head(rules_conf_r3,5))
rules_1 <- apriori (data=social_transaction,
parameter=list (supp=0.05,
conf = 0.3
),
appearance = list (default="lhs",
rhs="만족감=만족"))
#control = list (verbose=F))
rules_conf_1 <- sort (rules_1, by="confidence", decreasing=TRUE)
inspect(head(rules_conf_1,5))
write(rules_1, file = "data1.csv", sep = ",", col.names = NA)
rules_conf_1 <- sort (rules_1, by="lift", decreasing=TRUE)
inspect(head(rules_conf_1,5))
write(rules_1, file = "data2.csv", sep = ",", col.names = NA)
# lift순서와 confidence 순서가 같음
rules_2 <- apriori (data=social_transaction,
parameter=list (supp=0.05,
conf = 0.3
),
appearance = list (default="lhs",
rhs="만족감=보통"))
#control = list (verbose=F))
rules_conf_2 <- sort (rules_2, by="confidence", decreasing=TRUE)
inspect(head(rules_conf_2,10))
write(rules, file = "data3.csv", sep = ",", col.names = NA)
rules_conf_2 <- sort (rules_2, by="lift", decreasing=TRUE)
inspect(head(rules_conf_2,10))
write(rules_2, file = "data4.csv", sep = ",", col.names = NA)
# 만족감이 보통인 경우는 lift를 기준으로 하였을 때 교육정도가 중요함을 알수 있음
rules_3 <- apriori (data=social_transaction,
parameter=list (supp=0.05,
conf = 0.3
),
appearance = list (default="lhs",
rhs="만족감=불만족"))
#control = list (verbose=F))
rules_conf_3 <- sort (rules_3, by="confidence", decreasing=TRUE)
inspect(head(rules_conf_3,5))
write(rules_3, file = "data5.csv", sep = ",", col.names = NA)
rules_conf_3 <- sort (rules_3, by="lift", decreasing=TRUE)
inspect(head(rules_conf_3,5))
write(rules_3, file = "data6.csv", sep = ",", col.names = NA)
#만족감 불만족의 경우 confidence와  lift가 차이가 없음
tree_data <- data.frame(만족감 = social$만족감,
기억.집중.가능.여부
= social$기억.집중.가능.여부,
자기개발.가능여부
= social$자기개발.가능여부,
생활수준.변화
= social$생활수준.변화,
인간관계
= social$인간관계,
기부경험
= social$기부경험,
계층의식
= social$계층의식,
소득.만족도
= social$소득.만족도,
교육정도
= social$교육정도,
혼인상태
= social$혼인상태)
summary(tree_data)
head(tree_data)
make_tree <- function(data, cp_ = -1, ...){
indexes = createDataPartition(tree_data$만족감, p = 0.6, list = FALSE)
train = data[indexes, ]
test = data[-indexes, ]
fit <- rpart(만족감~.,
data = train,
cp = cp_, method = "class", ...)
pred = predict(fit, test, type = "class", )
tmp <- data.frame(test, pred)
acc <- sum(tmp$만족감 == tmp$pred) / nrow(tmp)
#print(confusionMatrix(test$NObeyesdad, pred, positive = '4'))
print(acc * 100)
return(fit)
}
tree<-make_tree(tree_data, minsplit = 5, minbucket = 3, maxdepth = 15, cp_ = 0.002)
#pdf("tree.pdf")
#fancyRpartPlot(tree)
#dev.off()
windows()
fancyRpartPlot(tree)
#dev.off()
windows()
fancyRpartPlot(tree)
table(social$계층의식,social$만족감)
table(social$인간관계,social$만족감)
chisq.test(social$계층의식,social$만족감)
chisq.test(social$인간관계,social$만족감)
rules_conf_1 <- sort (rules_1, by="confidence", decreasing=TRUE)
inspect(head(rules_conf_1,5))
rules_conf_1 <- sort (rules_1, by="lift", decreasing=TRUE)
inspect(head(rules_conf_1,5))
rules_conf_1 <- sort (rules_1, by="confidence", decreasing=TRUE)
inspect(head(rules_conf_1,5))
rules_conf_1 <- sort (rules_1, by="lift", decreasing=TRUE)
inspect(head(rules_conf_1,5))
fancyRpartPlot(tree)
windows()
fancyRpartPlot(tree)
rules_conf_2 <- sort (rules_2, by="confidence", decreasing=TRUE)
inspect(head(rules_conf_2,5))
rules_conf_2 <- sort (rules_2, by="lift", decreasing=TRUE)
inspect(head(rules_conf_2,5))
fancyRpartPlot(tree)
rules_conf_3 <- sort (rules_3, by="confidence", decreasing=TRUE)
inspect(head(rules_conf_3,5))
rules_conf_3 <- sort (rules_3, by="lift", decreasing=TRUE)
inspect(head(rules_conf_3,5))
windows()
fancyRpartPlot(tree)
rules_d <- apriori (data=social_transaction,
parameter=list (supp=0.05,
conf = 0.3
),
appearance = list (default="rhs",
lhs="기부경험=있음"))
#control = list (verbose=F))
rules_conf_d <- sort (rules_d, by="confidence", decreasing=TRUE)
inspect(head(rules_conf_d,5))
rules_d <- apriori (data=social_transaction,
parameter=list (supp=0.05,
conf = 0.3
),
appearance = list (default="lhs",
rhs="기부경험=있음"))
rules_d <- apriori (data=social_transaction,
parameter=list (supp=0.05,
conf = 0.3
),
appearance = list (default="lhs",
rhs="기부경험=있음"))
#control = list (verbose=F))
rules_conf_d <- sort (rules_d, by="confidence", decreasing=TRUE)
inspect(head(rules_conf_d,5))
rules_d <- apriori (data=social_transaction,
parameter=list (supp=0.05,
conf = 0.3
),
appearance = list (default="lhs",
rhs="기부경험=있음"))
#control = list (verbose=F))
rules_conf_d <- sort (rules_d, by="confidence", decreasing=TRUE)
inspect(head(rules_conf_d,5))
rules_dx <- apriori (data=social_transaction,
parameter=list (supp=0.05,
conf = 0.3
),
appearance = list (default="lhs",
rhs="기부경험=있음"))
#control = list (verbose=F))
rules_conf_dx <- sort (rules_dx, by="confidence", decreasing=TRUE)
inspect(head(rules_conf_dx,5))
rules_d <- apriori (data=social_transaction,
parameter=list (supp=0.05,
conf = 0.3
),
appearance = list (default="lhs",
rhs="기부경험=있음"))
#control = list (verbose=F))
rules_conf_d <- sort (rules_d, by="confidence", decreasing=TRUE)
inspect(head(rules_conf_d,5))
rules_dx <- apriori (data=social_transaction,
parameter=list (supp=0.05,
conf = 0.3
),
appearance = list (default="lhs",
rhs="기부경험=없음"))
#control = list (verbose=F))
rules_conf_dx <- sort (rules_dx, by="confidence", decreasing=TRUE)
inspect(head(rules_conf_dx,5))
rules_d <- apriori (data=social_transaction,
parameter=list (supp=0.05,
conf = 0.3
),
appearance = list (default="lhs",
rhs="기부경험=있음"))
#control = list (verbose=F))
rules_conf_d <- sort (rules_d, by="confidence", decreasing=TRUE)
inspect(head(rules_conf_d,5))
rules_dx <- apriori (data=social_transaction,
parameter=list (supp=0.05,
conf = 0.3
),
appearance = list (default="lhs",
rhs="기부경험=없음"))
#control = list (verbose=F))
rules_conf_dx <- sort (rules_dx, by="confidence", decreasing=TRUE)
inspect(head(rules_conf_dx,5))
rules_e <- apriori (data=social_transaction,
parameter=list (supp=0.05,
conf = 0.3
),
appearance = list (default="lhs",
rhs="교육정도=4년제"))
#control = list (verbose=F))
rules_conf_e <- sort (rules_e, by="confidence", decreasing=TRUE)
inspect(head(rules_conf_e,5))
rules_ex <- apriori (data=social_transaction,
parameter=list (supp=0.05,
conf = 0.3
),
appearance = list (default="lhs",
rhs="교육정도=초등학교"))
#control = list (verbose=F))
rules_conf_ex <- sort (rules_ex, by="confidence", decreasing=TRUE)
inspect(head(rules_conf_ex,5))
rules_ex <- apriori (data=social_transaction,
parameter=list (supp=0.05,
conf = 0.2
),
appearance = list (default="lhs",
rhs="교육정도=초등학교"))
rules_e <- apriori (data=social_transaction,
parameter=list (supp=0.05,
conf = 0.3
),
appearance = list (default="lhs",
rhs="교육정도=4년제"))
#control = list (verbose=F))
rules_conf_e <- sort (rules_e, by="confidence", decreasing=TRUE)
inspect(head(rules_conf_e,5))
rules_ex <- apriori (data=social_transaction,
parameter=list (supp=0.05,
conf = 0.2
),
appearance = list (default="lhs",
rhs="교육정도=초등학교"))
#control = list (verbose=F))
rules_conf_ex <- sort (rules_ex, by="confidence", decreasing=TRUE)
inspect(head(rules_conf_ex,5))
rules_e <- apriori (data=social_transaction,
parameter=list (supp=0.05,
conf = 0.3
),
appearance = list (default="lhs",
rhs="교육정도=4년제"))
#control = list (verbose=F))
rules_conf_e <- sort (rules_e, by="confidence", decreasing=TRUE)
inspect(head(rules_conf_e,5))
rules_ex <- apriori (data=social_transaction,
parameter=list (supp=0.01,
conf = 0.2
),
appearance = list (default="lhs",
rhs="교육정도=초등학교"))
#control = list (verbose=F))
rules_conf_ex <- sort (rules_ex, by="confidence", decreasing=TRUE)
inspect(head(rules_conf_ex,5))
