library(dplyr)
library(tidyverse)
library(rpart)
library(caret)
library(RColorBrewer)
library(rattle)
library(party)
# 시드설정
set.seed(25)
#경로 강제로 상대경로로 변환하는 함수
set_file_directory <- function(){
source = rstudioapi::getSourceEditorContext()$path
source = head(unlist(strsplit(source, split = "/")),-1)
source = paste(source, collapse="/")
setwd(source)
}
set_file_directory()
# 데이터 불러오기
heart <- read.csv("./hcvdat0.csv", header = T)
# 데이터 전처리 : factor형으로 변경할거 변경
heart$Category = as.factor(heart$Category)
heart$Sex = as.factor(heart$Sex)
## Category -> CategoryF 헌혈 가능자 불가능자로 재분류
heart$CategoryF <- factor(615, levels = c("Donor", "No"))
heart$CategoryF[heart$Category %in% "0=Blood Donor" | heart$Category %in% "0s=suspect Blood Donor"] <- "Donor"
heart$CategoryF[heart$Category %in% "1=Hepatitis" | heart$Category %in% "2=Fibrosis" | heart$Category %in% "3=Cirrhosis"] <- "No"
# 미가공 데이터셋 남기기
rawheart = heart
drop <- c("X","Category")
rawheart = rawheart[,!(names(rawheart) %in% drop)]
## Ann과 Svm을 위해 실행가능하도록 가공
forAnnSvm = rawheart
forAnnSvm$ALB[is.na(forAnnSvm$ALB)] <- median(forAnnSvm$ALB, na.rm = T)
forAnnSvm$ALP[is.na(forAnnSvm$ALP)] <- median(forAnnSvm$ALP, na.rm = T)
forAnnSvm$ALT[is.na(forAnnSvm$ALT)] <- median(forAnnSvm$ALT, na.rm = T)
forAnnSvm$AST[is.na(forAnnSvm$AST)] <- median(forAnnSvm$AST, na.rm = T)
forAnnSvm$BIL[is.na(forAnnSvm$BIL)] <- median(forAnnSvm$BIL, na.rm = T)
forAnnSvm$CHE[is.na(forAnnSvm$CHE)] <- median(forAnnSvm$CHE, na.rm = T)
forAnnSvm$CHOL[is.na(forAnnSvm$CHOL)] <- median(forAnnSvm$CHOL, na.rm = T)
forAnnSvm$CREA[is.na(forAnnSvm$CREA)] <- median(forAnnSvm$CREA, na.rm = T)
forAnnSvm$GGT[is.na(forAnnSvm$GGT)] <- median(forAnnSvm$GGT, na.rm = T)
forAnnSvm$PROT[is.na(forAnnSvm$PROT)] <- median(forAnnSvm$PROT, na.rm = T)
## Sex -> SexF 1남자 0여자로 바꿈
forAnnSvm$MaleF <- factor(615, levels = c(1, 0))
forAnnSvm$MaleF[heart$Sex %in% "m" ] <- 1
forAnnSvm$MaleF[heart$Sex %in% "f" ] <- 0
forAnnSvm$FemaleF <- factor(615, levels = c(1, 0))
forAnnSvm$FemaleF[heart$Sex %in% "m" ] <- 0
forAnnSvm$FemaleF[heart$Sex %in% "f" ] <- 1
drop <- c("Sex")
forAnnSvm = forAnnSvm[,!(names(forAnnSvm) %in% drop)]
## GGT -> GGTF GGT를 정상범위에 맞추어 factor화
##https://www.amc.seoul.kr/asan/healthinfo/management/managementDetail.do?managementId=36
heart$GGTF <- factor(615, levels = c("normal", "abnormal"))
heart$GGTF[((heart$GGT >= 10 & heart$GGT <= 71) & heart$Sex %in% "m") | ((heart$GGT >= 6 & heart$GGT <= 42) & heart$Sex %in% "f")] <- "normal"
heart$GGTF[((heart$GGT < 10 | heart$GGT > 71) & heart$Sex %in% "m") | ((heart$GGT < 6 | heart$GGT > 42) & heart$Sex %in% "f")] <- "abnormal"
## ALT -> ALTF ALT 정상범위에 맞추어 factor화
## https://www.amc.seoul.kr/asan/healthinfo/management/managementDetail.do?managementId=36
heart$ALTF <- factor(615, levels = c("normal", "abnormal"))
heart$ALTF[heart$ALT <= 40] <- "normal"
heart$ALTF[heart$ALT > 40] <- "abnormal"
## AST -> ASTF AST 정상범위에 맞추어 factor화
## https://www.amc.seoul.kr/asan/healthinfo/management/managementDetail.do?managementId=36
heart$ASTF <- factor(615, levels = c("normal", "abnormal"))
heart$ASTF[heart$AST <= 40] <- "normal"
heart$ASTF[heart$AST > 40] <- "abnormal"
## CHOL -> CHOLF CHOL 정상범위에 맞추어
## https://www.webmd.com/cholesterol-management/cholesterol-tests-understand-your-results
## HDL 농도로 판단.
heart$CHOLF <- factor(615, levels = c("normal", "abnormal"))
heart$CHOLF[(heart$CHOL <= 4 & heart$Sex %in% "m") | (heart$CHOL <= 5 & heart$Sex %in% "f")] <- "abnormal"
heart$CHOLF[(heart$CHOL > 4 & heart$Sex %in% "m") | (heart$CHOL > 5 & heart$Sex %in% "f")] <- "normal"
## CREA -> CREAF CREA 정상범위에 맞추어
##https://www.mountsinai.org/health-library/tests/creatinine-blood-test#:~:text=Normal%20Results,less%20muscle%20mass%20than%20men.
heart$CREAF <- factor(615, levels = c("normal", "abnormal"))
heart$CREAF[((heart$CREA >= 61.9 & heart$CREA <= 114.9) & heart$Sex %in% "m") | ((heart$CREA >= 53 & heart$CREA <= 97.2) & heart$Sex %in% "f")] <- "normal"
heart$CREAF[((heart$CREA < 61.9 | heart$CREA > 114.9) & heart$Sex %in% "m") | ((heart$CREA < 53 | heart$CREA > 97.2) & heart$Sex %in% "f")] <- "abnormal"
## CHE -> CHEF CHE 정상범위에 맞추어
## https://www.ucsfhealth.org/medical-tests/cholinesterase---blood#:~:text=Normal%20Results,vary%20slightly%20among%20different%20laboratories.
heart$CHEF<- factor(615, levels = c("normal", "abnormal"))
heart$CHEF[heart$CHE >= 8 & heart$CHE <= 18] <- "normal"
heart$CHEF[heart$CHE < 8 | heart$CHE > 18] <- "abnormal"
## ALB -> ALBF ALB 정상범위에 맞추어 factor화
## https://www.amc.seoul.kr/asan/healthinfo/management/managementDetail.do?managementId=36
heart$ALBF<- factor(615, levels = c("normal", "abnormal"))
heart$ALBF[heart$ALB >= 35 & heart$ALB <= 52] <- "normal"
heart$ALBF[heart$ALB < 35 | heart$ALB > 52] <- "abnormal"
## ALP -> ALPF ALP 정상범위에 맞추어 factor화
## https://www.amc.seoul.kr/asan/healthinfo/management/managementDetail.do?managementId=36
heart$ALPF<- factor(615, levels = c("normal", "abnormal"))
heart$ALPF[heart$ALP >= 40 & heart$ALP <= 120] <- "normal"
heart$ALPF[heart$ALP < 40 | heart$ALP > 120] <- "abnormal"
## PROT -> PROTF PROT 정상범위에 맞추어 factor화
## https://www.amc.seoul.kr/asan/healthinfo/management/managementDetail.do?managementId=36
heart$PROTF<- factor(615, levels = c("normal", "abnormal"))
heart$PROTF[heart$PROT >= 66 & heart$PROT <= 87] <- "normal"
heart$PROTF[heart$PROT < 66 | heart$PROT > 87] <- "abnormal"
## BIL -> BILF BIL 정상범위에 맞추어 factor화
## https://www.amc.seoul.kr/asan/healthinfo/management/managementDetail.do?managementId=36
heart$BILF<- factor(615, levels = c("normal", "abnormal"))
heart$BILF[heart$BIL >= 1 & heart$BIL <= 12] <- "normal"
heart$BILF[heart$BIL < 1 | heart$BIL > 12] <- "abnormal"
## factor 형변환한 수치형 변수들 드랍
drop <- c("Category",	"ALB", "ALP",	"ALT",	"AST",	"BIL",	"CHE",	"CHOL",	"CREA",	"GGT", "PROT","X")
heart = heart[,!(names(heart) %in% drop)]
##heart TRAIN집단,TEST집단 분류
indexes = createDataPartition(heart$CategoryF, p = .66, list=F)
train = heart[indexes, ]
test =  heart[-indexes, ]
##rawheart TRAIN집단,TEST집단 분류
rawindexes = createDataPartition(rawheart$CategoryF, p = .66, list=F)
rawtrain = rawheart[rawindexes, ]
rawtest =  rawheart[-rawindexes, ]
##forAnnSvm TRAIN집단,TEST집단 분류
findexes = createDataPartition(forAnnSvm$CategoryF, p = .66, list=F)
ftrain = forAnnSvm[findexes, ]
ftest =  forAnnSvm[-findexes, ]
