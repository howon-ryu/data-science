split
ensembledata<-heart[0:split,]
blenderdata<-heart[(split+1):(split*2),]
testingdata<-heart[(split*2+1):nrow(heart),]
labelname<-'Category'
labelname
predictors <- names(ensembledata)[names(ensembledata) != labelname]
predictors
myControl <- trainControl(method='cv', number=3, returnResamp='none')
myControl
test_model <- train(blenderdata[,predictors], blenderdata[,labelname], method='gbm', trControl=myControl)
test_model <- train(blenderdata[,predictors], blenderdata[,labelname], method='gbm', trControl=myControl)
blenderdata[,predictors]
preds_before <- predict(object=test_model, testingdata[,predictors])
tmp_before <- data.frame(testingdata, preds_before)
tmp_before
summary(preds_before)
acc <- sum(tmp_before$Category == tmp_before$preds_before) / nrow(tmp)
acc
testingdata[,labelname]
auc <- roc(testingdata[,labelname], preds_before)
print(auc$auc)
labelname<-'Category'
labelname
predictors <- names(ensembledata)[names(ensembledata) != labelname]
predictors
myControl <- trainControl(method='cv', number=3, returnResamp='none')
myControl
test_model <- train(blenderdata[,predictors], blenderdata[,labelname], method='gbm', trControl=myControl)
blenderdata[,predictors]
preds_before <- predict(object=test_model, testingdata[,predictors])
heart<- read.csv("hcvdat.csv", header = T)
summary(heart)
head(heart)
heart$Sex[heart$Sex %in% "m"]<-as.numeric(1)
heart$Sex[heart$Sex %in% "f"]<-as.numeric(2)
heart$Sex
heart$Sex<-as.numeric(heart$Sex)
summary(heart)
heart$CategoryF <- factor(615, levels = c(1, 0))
heart$CategoryF[heart$Category %in% "0=Blood Donor" | heart$Category %in% "0s=suspect Blood Donor"] <- "Donor"
heart$CategoryF[heart$Category %in% "1=Hepatitis" | heart$Category %in% "2=Fibrosis" | heart$Category %in% "3=Cirrhosis"] <- "NO"
# 순번 1번열, 전처리 전 카테고리 열 제거
heart<-heart[0:-2]
heart$CategoryF <- factor(615, levels = c("Donor", "NO"))
heart$CategoryF[heart$Category %in% "0=Blood Donor" | heart$Category %in% "0s=suspect Blood Donor"] <- "Donor"
heart$CategoryF[heart$Category %in% "1=Hepatitis" | heart$Category %in% "2=Fibrosis" | heart$Category %in% "3=Cirrhosis"] <- "NO"
# 순번 1번열, 전처리 전 카테고리 열 제거
heart<-heart[0:-2]
head(heart)
prop.table(table(heart$CategoryF))
set.seed(615)
heart<-heart[sample(nrow(heart)),]
split<-floor(nrow(heart)/3)
split
ensembledata<-heart[0:split,]
blenderdata<-heart[(split+1):(split*2),]
testingdata<-heart[(split*2+1):nrow(heart),]
labelname<-'CategoryF'
labelname
predictors <- names(ensembledata)[names(ensembledata) != labelname]
predictors
myControl <- trainControl(method='cv', number=3, returnResamp='none')
myControl
test_model <- train(blenderdata[,predictors], blenderdata[,labelname], method='gbm', trControl=myControl)
blenderdata[,predictors]
preds_before <- predict(object=test_model, testingdata[,predictors])
tmp_before <- data.frame(testingdata, preds_before)
tmp_before
acc <- sum(tmp_before$CategoryF == tmp_before$preds_before) / nrow(tmp)
acc
auc <- roc(testingdata[,labelname], preds_before)
acc <- sum(tmp_before$CategoryF == tmp_before$preds_before) / nrow(tmp)
tmp_before
heart$CategoryF <- factor(615, levels = c("Donor", "NO"))
heart$CategoryF[heart$Category %in% "0=Blood Donor" | heart$Category %in% "0s=suspect Blood Donor"] <- "Donor"
heart$CategoryF[heart$Category %in% "1=Hepatitis" | heart$Category %in% "2=Fibrosis" | heart$Category %in% "3=Cirrhosis"] <- "NO"
# 순번 1번열, 전처리 전 카테고리 열 제거
heart<-heart[0:-2]
heart$CategoryF
heart<- read.csv("hcvdat.csv", header = T)
summary(heart)
head(heart)
heart$Sex[heart$Sex %in% "m"]<-as.numeric(1)
heart$Sex[heart$Sex %in% "f"]<-as.numeric(2)
heart$Sex
heart$Sex<-as.numeric(heart$Sex)
summary(heart)
heart$CategoryF <- factor(615, levels = c("Donor", "NO"))
heart$CategoryF[heart$Category %in% "0=Blood Donor" | heart$Category %in% "0s=suspect Blood Donor"] <- "Donor"
heart$CategoryF[heart$Category %in% "1=Hepatitis" | heart$Category %in% "2=Fibrosis" | heart$Category %in% "3=Cirrhosis"] <- "NO"
heart$CategoryF
# 순번 1번열, 전처리 전 카테고리 열 제거
heart<-heart[0:-2]
head(heart)
prop.table(table(heart$CategoryF))
set.seed(615)
heart<-heart[sample(nrow(heart)),]
split<-floor(nrow(heart)/3)
split
ensembledata<-heart[0:split,]
blenderdata<-heart[(split+1):(split*2),]
testingdata<-heart[(split*2+1):nrow(heart),]
labelname<-'CategoryF'
labelname
predictors <- names(ensembledata)[names(ensembledata) != labelname]
predictors
myControl <- trainControl(method='cv', number=3, returnResamp='none')
myControl
test_model <- train(blenderdata[,predictors], blenderdata[,labelname], method='gbm', trControl=myControl)
blenderdata[,predictors]
preds_before <- predict(object=test_model, testingdata[,predictors])
tmp_before <- data.frame(testingdata, preds_before)
tmp_before
acc <- sum(tmp_before$CategoryF == tmp_before$preds_before) / nrow(tmp)
acc
auc <- roc(testingdata[,labelname], preds_before)
testingdata[,predictors])
testingdata[,predictors]
preds_before <- ROCR::prediction(predict(object=test_model, testingdata[,predictors],type="raw"),testingdata[,labelname])
roc <-performance(preds_before,"tpr","fpr")
plot(roc,colorize = TRUE)
library(scales)
library(reshape)
preds_before <- ROCR::prediction(predict(object=test_model, testingdata[,predictors],type="raw"),testingdata[,labelname])
preds_before <- ROCR::prediction(as.numeric(predict(object=test_model, testingdata[,predictors],type="raw")),as.numeric(testingdata[,labelname]))
roc <-performance(preds_before,"tpr","fpr")
plot(roc,colorize = TRUE)
auc <- roc(testingdata[,labelname], preds_before)
auc <- roc(as.numeric(testingdata[,labelname]), as.numeric(preds_before))
preds_bef<-predict(object=test_model,testingdata[,predictors])
auc <- roc(as.numeric(testingdata[,labelname]), as.numeric(preds_bef))
print(roc$auc)
print(preds_before$auc)
model_gbm <- train(ensembledata[,predictors], ensembledata[,labelname], method='gbm', trControl=myControl)
model_rpart <- train(ensembledata[,predictors], ensembledata[,labelname], method='rpart', trControl=myControl)
model_treebag <- train(ensembledata[,predictors], ensembledata[,labelname], method='treebag', trControl=myControl)
blenderdata$gbm_PROB <- predict(object=model_gbm, blenderdata[,predictors])
blenderdata$rf_PROB <- predict(object=model_rpart, blenderdata[,predictors])
blenderdata$treebag_PROB <- predict(object=model_treebag, blenderdata[,predictors])
testingdata$gbm_PROB <- predict(object=model_gbm, testingdata[,predictors])
testingdata$rf_PROB <- predict(object=model_rpart, testingdata[,predictors])
testingdata$treebag_PROB <- predict(object=model_treebag, testingdata[,predictors])
predictors <- names(blenderdata)[names(blenderdata) != labelname]
final_blender_model <- train(blenderdata[,predictors], blenderdata[,labelname], method='rpart', trControl=myControl)
blenderdata[,predictors]
blenderdata[,labelname]
preds_after <- ROCR::prediction(as.numeric(predict(object=final_blender_model, testingdata[,predictors],type="raw")),as.numeric(testingdata[,labelname]))
roc <-performance(preds_before,"tpr","fpr")
preds_bef<-predict(object=test_model,testingdata[,predictors])
plot(roc,colorize = TRUE)
myControl <- trainControl(method='cv', number=3, returnResamp='none')
myControl
test_model <- train(blenderdata[,predictors], blenderdata[,labelname], method='gbm', trControl=myControl)
blenderdata[,predictors]
testingdata[,predictors]
preds_before <- ROCR::prediction(as.numeric(predict(object=test_model, testingdata[,predictors],type="raw")),as.numeric(testingdata[,labelname]))
roc <-performance(preds_before,"tpr","fpr")
preds_bef<-predict(object=test_model,testingdata[,predictors])
plot(roc,colorize = TRUE)
# bagging model
indexes = createDataPartition(heart$CategoryF, p = .66, list=F)
train = heart[indexes, ]
is.na(train)
train<-na.omit(train)
test =  heart[-indexes, ]
is.na(test)
train<-na.omit(test)
auc(roc)
preds_before <- ROCR::prediction(as.numeric(predict(object=test_model, testingdata[,predictors],type="raw")),as.numeric(testingdata[,labelname]))
roc <-performance(preds_before,"tpr","fpr")
auc(roc)
# bagging model
indexes = createDataPartition(heart$CategoryF, p = .66, list=F)
train = heart[indexes, ]
is.na(train)
train<-na.omit(train)
test =  heart[-indexes, ]
is.na(test)
train<-na.omit(test)
heart.bagging<-bagging(CategoryF~., data=heart, mfinal=10)
heart.bagging$importance
heart.bagging
# 도식솨
plot(heart.bagging$trees[[10]])
# bagging model
indexes = createDataPartition(heart$CategoryF, p = .66, list=F)
train = heart[indexes, ]
is.na(train)
train<-na.omit(train)
test =  heart[-indexes, ]
is.na(test)
train<-na.omit(test)
heart.bagging<-bagging(CategoryF~., data=heart, mfinal=10)
heart.bagging$importance
heart.bagging
# 도식솨
plot(heart.bagging$trees[[10]])
text(heart.bagging$trees[[10]])
#예측값
pred_bagging<-predict(heart.bagging, newdata = heart)
pred_bagging
#정오분류표
table(pred_bagging$class, heart[,13])
pred_bagging$class
tmp <- data.frame(heart, pred_bagging$class)
tmp
confusionMatrix(heart[,13],pred_bagging$class)
#정확도
acc <- sum(tmp$CategoryF == tmp$pred_bagging.class) / nrow(tmp)
acc
bagging.roc<-roc(tmp$CategoryF, pred_bagging$class)
bagging.roc<-roc(as.numeric(tmp$CategoryF), as.numeric(pred_bagging$class))
is.NAs(tmp$CategoryF)
is.NA(tmp$CategoryF)
is.na(tmp$CategoryF)
is.na(pred_bagging$class)
bagging.roc<-roc(as.numeric(tmp$CategoryF), as.numeric(pred_bagging$class))
pred_bagging$class
pred_bagging
bagging.roc<-roc(as.numeric(pred_bagging$class),as.numeric(tmp$CategoryF))
bagging.roc<-roc(pred_bagging$class,tmp$CategoryF)
bagging.roc<-roc(pred_bagging$class,as.numeric(tmp$CategoryF))
bagging.roc<-roc(pred_bagging$class,as.numeric(tmp$CategoryF), quiet = FALSE)
bagging.roc<-roc(pred_bagging$class,as.numeric(tmp$CategoryF), levels = c(0, 1), direction = "<")
bagging.roc<-roc(as.numeric(pred_bagging$class),tmp$CategoryF)
bagging.roc<-roc(pred_bagging$class,tmp$CategoryF)
heart.bagging
#예측값
pred_bagging<-predict(heart.bagging, newdata = test)
pred_bagging
#정오분류표
table(pred_bagging$class, heart[,13])
heart.bagging<-bagging(CategoryF~., data=train, mfinal=10)
heart.bagging$importance
heart.bagging
# 도식솨
plot(heart.bagging$trees[[10]])
text(heart.bagging$trees[[10]])
#예측값
pred_bagging<-predict(heart.bagging, newdata = test)
pred_bagging
#정오분류표
table(pred_bagging$class, heart[,13])
pred_bagging$class
#정오분류표
table(pred_bagging$class, test[,13])
pred_bagging$class
tmp <- data.frame(heart, pred_bagging$class)
tmp
confusionMatrix(heart[,13],pred_bagging$class)
#정확도
acc <- sum(tmp$CategoryF == tmp$pred_bagging.class) / nrow(tmp)
acc
is.na(pred_bagging$class)
bagging.roc<-roc(pred_bagging$class,tmp$CategoryF)
bagging.roc<-roc(pred_bagging$class,as.numeric(tmp$CategoryF))
# bagging model
indexes = createDataPartition(heart$CategoryF, p = .66, list=F)
train = heart[indexes, ]
is.na(train)
train<-na.omit(train)
test =  heart[-indexes, ]
is.na(test)
train<-na.omit(test)
heart.bagging<-bagging(CategoryF~., data=heart, mfinal=10)
heart.bagging$importance
heart.bagging
# 도식솨
plot(heart.bagging$trees[[10]])
text(heart.bagging$trees[[10]])
#예측값
pred_bagging<-predict(heart.bagging, newdata = heart)
pred_bagging
#정오분류표
table(pred_bagging$class, heart[,13])
pred_bagging$class
tmp <- data.frame(heart, pred_bagging$class)
tmp
confusionMatrix(heart[,13],pred_bagging$class)
#정확도
acc <- sum(tmp$CategoryF == tmp$pred_bagging.class) / nrow(tmp)
acc
is.na(pred_bagging$class)
bagging.roc<-roc(pred_bagging$class,tmp$CategoryF)
summary(pred_bagging$class)
summary(tmp$CategoryF)
pred_bagging$class
tmp$CategoryF
str(pred_bagging$class)
str(tmp$CategoryF)
is.data.frame(pred_bagging$class)
is.data.frame(tmp$CategoryF)
heart
tmp
bagging.roc<-roc(pred_bagging$class,heart$CategoryF)
is.character(pred_bagging$class)
is.character(tmp$CategoryF)
as.factor(pred_bagging$class)
bagging.roc<-roc(pred_bagging$class,heart$CategoryF)
bagging.roc<-roc(pred_bagging$class,as.numeric(heart$CategoryF))
is.character(heart$CategoryF)
is.factor(heart$CategoryF)
is.factor(pred_bagging$class)
as.factor(pred_bagging$class)
is.factor(pred_bagging$class)
tmp$CategoryF
summary(pred_bagging$class)
summary(tmp$CategoryF)
as.factor(pred_bagging$class[1])
is.factor(pred_bagging$class[1])
preds <- ROCR::prediction(pred_bagging$class,as.numeric(heart$CategoryF))
roc <-performance(preds,"tpr","fpr")
preds <- ROCR::prediction(pred_bagging$class,heart$CategoryF)
require(randomForest)
require(mlbench)
data(Sonar)
heart.bagging
heart.bagging$votes
heart.bagging$votes[,2]
bagging.roc<-roc(pred_bagging$class,heart.bagging$votes[,2])
bagging.roc<-roc(pred_bagging$class,pred_bagging$votes[,2])
plot(bagging.roc)
auc(bagging.roc)
bagging.roc<-roc(pred_bagging$class,heart$CategoryF)
bagging.roc<-roc(pred_bagging$class,as.numeric(heart$CategoryF))
plot(bagging.roc)
auc(bagging.roc)
#boosting
heart.adabag<-boosting(CategoryF~., data=heart,boos = TRUE, mfinal=10)
heart.adabag$importance
#도식화
plot(heart.adabag$trees[[10]])
text(heart.adabag$trees[[10]])
#예측값
pred_boosting<-predict(heart.adabag, newdata = heart)
#정오 분류표
tb<- table(pred_boosting$class,heart[,13])
#boosting
heart.adabag<-boosting(CategoryF~., data=heart,boos = TRUE, mfinal=10)
heart.adabag$importance
#도식화
plot(heart.adabag$trees[[10]])
text(heart.adabag$trees[[10]])
#예측값
pred_boosting<-predict(heart.adabag, newdata = heart)
#정오 분류표
tb<- table(pred_boosting$class,heart[,13])
tb
#오분류율
error.rpart <- 1-(sum(diag(tb)/sum(tb)))
error.rpart
#정확도
tmp_bag <- data.frame(heart, pred_boosting$class)
tmp_bag
acc_bag <- sum(tmp_bag$CategoryF == tmp_bag$pred_boosting.class) / nrow(tmp_bag)
acc_bag
boosting.roc<-roc(pred_boosting$class,as.numeric(heart$CategoryF))
plot(boosting.roc)
auc(boosting.roc)
acc_bag
#정오 분류표
tb<- table(pred_boosting$class,heart[,13])
tb
acc <- sum(tmp_before$CategoryF == tmp_before$preds_before) / nrow(tmp)
acc
# 순번 1번열, 전처리 전 카테고리 열 제거
heart<-heart[0:-2]
head(heart)
prop.table(table(heart$CategoryF))
set.seed(615)
heart<-heart[sample(nrow(heart)),]
split<-floor(nrow(heart)/3)
split
ensembledata<-heart[0:split,]
blenderdata<-heart[(split+1):(split*2),]
testingdata<-heart[(split*2+1):nrow(heart),]
labelname<-'CategoryF'
labelname
predictors <- names(ensembledata)[names(ensembledata) != labelname]
predictors
myControl <- trainControl(method='cv', number=3, returnResamp='none')
myControl
test_model <- train(blenderdata[,predictors], blenderdata[,labelname], method='gbm', trControl=myControl)
blenderdata[,predictors]
testingdata[,predictors]
preds_before <- ROCR::prediction(as.numeric(predict(object=test_model, testingdata[,predictors],type="raw")),as.numeric(testingdata[,labelname]))
roc <-performance(preds_before,"tpr","fpr")
auc(roc)
preds_bef<-predict(object=test_model,testingdata[,predictors])
plot(roc,colorize = TRUE)
tmp_before <- data.frame(testingdata, preds_before)
tmp_before
acc <- sum(tmp_before$CategoryF == tmp_before$preds_before) / nrow(tmp)
acc
auc <- roc(as.numeric(testingdata[,labelname]), as.numeric(preds_bef))
heart<- read.csv("hcvdat.csv", header = T)
summary(heart)
head(heart)
heart$Sex[heart$Sex %in% "m"]<-as.numeric(1)
heart$Sex[heart$Sex %in% "f"]<-as.numeric(2)
heart$Sex
heart$Sex<-as.numeric(heart$Sex)
summary(heart)
heart$CategoryF <- factor(615, levels = c("Donor", "NO"))
heart$CategoryF[heart$Category %in% "0=Blood Donor" | heart$Category %in% "0s=suspect Blood Donor"] <- "Donor"
heart$CategoryF[heart$Category %in% "1=Hepatitis" | heart$Category %in% "2=Fibrosis" | heart$Category %in% "3=Cirrhosis"] <- "NO"
heart$CategoryF
# 순번 1번열, 전처리 전 카테고리 열 제거
heart<-heart[0:-2]
head(heart)
prop.table(table(heart$CategoryF))
set.seed(615)
heart<-heart[sample(nrow(heart)),]
split<-floor(nrow(heart)/3)
split
ensembledata<-heart[0:split,]
blenderdata<-heart[(split+1):(split*2),]
testingdata<-heart[(split*2+1):nrow(heart),]
labelname<-'CategoryF'
labelname
predictors <- names(ensembledata)[names(ensembledata) != labelname]
predictors
myControl <- trainControl(method='cv', number=3, returnResamp='none')
myControl
test_model <- train(blenderdata[,predictors], blenderdata[,labelname], method='gbm', trControl=myControl)
blenderdata[,predictors]
testingdata[,predictors]
preds_before <- ROCR::prediction(as.numeric(predict(object=test_model, testingdata[,predictors],type="raw")),as.numeric(testingdata[,labelname]))
roc <-performance(preds_before,"tpr","fpr")
auc(roc)
preds_bef<-predict(object=test_model,testingdata[,predictors])
plot(roc,colorize = TRUE)
tmp_before <- data.frame(testingdata, preds_before)
tmp_before
acc <- sum(tmp_before$CategoryF == tmp_before$preds_before) / nrow(tmp)
acc
tmp_before$preds_before
tmp_before$CategoryF
heart<- read.csv("hcvdat.csv", header = T)
summary(heart)
head(heart)
heart$Sex[heart$Sex %in% "m"]<-as.numeric(1)
heart$Sex[heart$Sex %in% "f"]<-as.numeric(2)
heart$Sex
heart$Sex<-as.numeric(heart$Sex)
summary(heart)
heart$CategoryF <- factor(615, levels = c("Donor", "NO"))
heart$CategoryF[heart$Category %in% "0=Blood Donor" | heart$Category %in% "0s=suspect Blood Donor"] <- "Donor"
heart$CategoryF[heart$Category %in% "1=Hepatitis" | heart$Category %in% "2=Fibrosis" | heart$Category %in% "3=Cirrhosis"] <- "NO"
heart$CategoryF
# 순번 1번열, 전처리 전 카테고리 열 제거
heart<-heart[0:-2]
head(heart)
prop.table(table(heart$CategoryF))
set.seed(615)
heart<-heart[sample(nrow(heart)),]
split<-floor(nrow(heart)/3)
split
ensembledata<-heart[0:split,]
blenderdata<-heart[(split+1):(split*2),]
testingdata<-heart[(split*2+1):nrow(heart),]
labelname<-'CategoryF'
labelname
predictors <- names(ensembledata)[names(ensembledata) != labelname]
predictors
myControl <- trainControl(method='cv', number=3, returnResamp='none')
myControl
test_model <- train(blenderdata[,predictors], blenderdata[,labelname], method='gbm', trControl=myControl)
blenderdata[,predictors]
testingdata[,predictors]
#preds_before <- ROCR::prediction(as.numeric(predict(object=test_model, testingdata[,predictors],type="raw")),as.numeric(testingdata[,labelname]))
#roc <-performance(preds_before,"tpr","fpr")
#auc(roc)
preds_bef<-predict(object=test_model,testingdata[,predictors])
tmp_before <- data.frame(testingdata, preds_before)
tmp_before
tmp_before$preds_before
tmp_before$CategoryF
acc <- sum(tmp_before$CategoryF == tmp_before$preds_before) / nrow(tmp)
acc
auc <- roc(as.numeric(testingdata[,labelname]), as.numeric(preds_bef))
print(auc$auc)
model_gbm <- train(ensembledata[,predictors], ensembledata[,labelname], method='gbm', trControl=myControl)
model_rpart <- train(ensembledata[,predictors], ensembledata[,labelname], method='rpart', trControl=myControl)
model_treebag <- train(ensembledata[,predictors], ensembledata[,labelname], method='treebag', trControl=myControl)
blenderdata$gbm_PROB <- predict(object=model_gbm, blenderdata[,predictors])
blenderdata$rf_PROB <- predict(object=model_rpart, blenderdata[,predictors])
blenderdata$treebag_PROB <- predict(object=model_treebag, blenderdata[,predictors])
testingdata$gbm_PROB <- predict(object=model_gbm, testingdata[,predictors])
testingdata$rf_PROB <- predict(object=model_rpart, testingdata[,predictors])
testingdata$treebag_PROB <- predict(object=model_treebag, testingdata[,predictors])
predictors <- names(blenderdata)[names(blenderdata) != labelname]
final_blender_model <- train(blenderdata[,predictors], blenderdata[,labelname], method='rpart', trControl=myControl)
blenderdata[,predictors]
blenderdata[,labelname]
preds_after <- predict(object=final_blender_model, testingdata[,predictors])
preds_after
tmp_after <- data.frame(testingdata, preds_after)
tmp_after
acc <- sum(tmp_after$CategoryF == tmp_after$preds_after) / nrow(tmp)
acc
tmp_before <- data.frame(testingdata, preds_bef)
tmp_before
tmp_before$preds_before
tmp_before$CategoryF
acc <- sum(tmp_before$CategoryF == tmp_before$preds_before) / nrow(tmp)
acc
acc <- sum(tmp_before$CategoryF == tmp_before$preds_bef) / nrow(tmp)
acc
acc <- sum(tmp_before$CategoryF == tmp_before$preds_bef) / nrow(tmp_before)
acc
